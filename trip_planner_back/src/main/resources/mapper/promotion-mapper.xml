<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.or.iei.promotion.model.dao.PromotionDao">
	<select id="totalCount" resultType="int">
		select count(*) from promotion_tbl 
	</select>
 	<select id="selectPromotionList" resultType="promotion">
 	select * from
	    (select rownum as rnum, b.*from
	        (select 
	        	promotion_no,
	        	partner_no,
	        	promotion_name,
	        	promotion_img,
	        	promotion_price,
	        	promotion_intro,
	        	promotion_region,
	        	promotion_limit,
	        	to_char(promotion_expired_date,'YYYY-MM-DD') 
	        	from promotion_tbl 
	        	 order by promotion_no desc)b)
	where rnum between #{start} and #{end}
 	</select>
 	<select id="selectPromotionListRegion" resultType="promotion">
 	select * from
	    (select rownum as rnum, b.*from
	        (select 
	        	promotion_no,
	        	partner_no,
	        	promotion_name,
	        	promotion_img,
	        	promotion_price,
	        	promotion_intro,
	        	promotion_region,
	        	promotion_limit,
	        	to_char(promotion_expired_date,'YYYY-MM-DD') 
	        from promotion_tbl 
	        	 order by promotion_region desc)b)
	where rnum between #{start} and #{end}
 	</select>
 	<select id="selectPromotionListPrice" resultType="promotion">
 	select * from
	    (select rownum as rnum, b.*from
	        (select 
	        	promotion_no,
	        	partner_no,
	        	promotion_name,
	        	promotion_img,
	        	promotion_price,
	        	promotion_intro,
	        	promotion_region,
	        	promotion_limit,
	        	to_char(promotion_expired_date,'YYYY-MM-DD') 
	        from promotion_tbl 
	        	 order by promotion_price asc)b)
	where rnum between #{start} and #{end}
 	</select>
 	<select id="selectPromotionListDeadline" resultType="promotion">
 	select * from
	    (select rownum as rnum, b.*from
	        (select 
	        	promotion_no,
	        	partner_no,
	        	promotion_name,
	        	promotion_img,
	        	promotion_price,
	        	promotion_intro,
	        	promotion_region,
	        	promotion_limit,
	        	to_char(promotion_expired_date,'YYYY-MM-DD') 
	         from promotion_tbl 
	        	 order by promotion_expired_date asc)b)
	where rnum between #{start} and #{end}
 	</select>
 	
 	<select id="totalSearchCount" resultType="int">
		select count(*) from promotion_tbl where promotion_name like '%'||#{keyword}||'%'
	</select>
 	
 	<select id="selectPromotionListSearch" resultType="promotion">
 	select * from 
	    (select rownum as rnum, b.*from
	        (select 
	        	promotion_no,
	        	partner_no,
	        	promotion_name,
	        	promotion_img,
	        	promotion_price,
	        	promotion_intro,
	        	promotion_region,
	        	promotion_limit,
	        	to_char(promotion_expired_date,'YYYY-MM-DD') 
	        from promotion_tbl where promotion_name like '%'||#{keyword}||'%'
	        	 order by promotion_no desc)b)
	where rnum between #{start} and #{end}
 	</select>
 	<select id="selectBookPromotionList">
 		select * from
			(select rownum rnum, pt.* from
			(select promotion_no, promotion_name, promotion_expired_date, promotion_img,
			(select order_no from promotion_order_tbl where promotion_no=p.promotion_no) order_no,
			(select
			    case
			        when partner_type=1
			        then '숙소'
			        when partner_type=2
			        then '투어'
			    end
			from partner_tbl where partner_no = p.partner_no) promotion_type
			from promotion_tbl p
			where promotion_no in (select promotion_no from promotion_order_tbl where member_no in (select member_no from member_tbl where member_email=#{memberEmail}))order by promotion_expired_date desc)pt)
			where rnum between #{start} and #{end}
 	</select>
</mapper>
